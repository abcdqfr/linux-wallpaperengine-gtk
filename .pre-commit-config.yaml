---
repos:
  # Ruff - Fast Python linter and formatter (always enabled)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.8
    hooks:
      - id: ruff
        args: [--fix, --select=E, F, B, I, W, UP, ARG, PLR, PERF, SIM]
      - id: ruff-format

  # Black - Uncompromising Python code formatter (always enabled)
  - repo: https://github.com/psf/black
    rev: 25.12.0
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=100]

  # Bandit - Security linter (ENABLED with custom config)
  - repo: https://github.com/PyCQA/bandit
    rev: 1.9.2
    hooks:
      - id: bandit
        args: [-r, ., -ll, --skip, B101, B601] # Skip assert_used, shell_injection_subprocess
        files: ^linux-wallpaperengine-gtk\.py$

  # Pylint - Comprehensive linting (ENABLED)
  - repo: https://github.com/pre-commit/mirrors-pylint
    rev: v3.0.0a5
    hooks:
      - id: pylint
        args: [
            --disable=C0111,
            C0103,
            R0903,
            R0913,
            C0301,
            --max-line-length=100,
          ] # Disable docstring, naming, too-few/many args, line-too-long (handled by formatter)
        files: ^linux-wallpaperengine-gtk\.py$

  # MyPy - Static type checker (conditional based on version)
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.0
    hooks:
      - id: mypy
        args: [--ignore-missing-imports, --no-strict-optional]
        files: ^linux-wallpaperengine-gtk\.py$

  # Xenon (Radon) - Complexity checker (remote hook using radon)
  # References:
  #   - Xenon: https://github.com/rubik/xenon
  #   - pre-commit-xenon: https://github.com/yunojuno/pre-commit-xenon
  - repo: https://github.com/yunojuno/pre-commit-xenon
    rev: v0.1
    hooks:
      - id: xenon
        args: [--max-average, B, --max-modules, B, --max-absolute, B]
        files: ^linux-wallpaperengine-gtk\.py$

  # Vulture - Dead code detection (NEW)
  - repo: https://github.com/jendrikseipp/vulture
    rev: v2.14
    hooks:
      - id: vulture
        args: ["--min-confidence", "80"]
        files: ^linux-wallpaperengine-gtk\.py$

  # Custom hook: Check for common bugs (Python-based, not bash!)
  # References:
  #   - pre-commit local hooks: https://pre-commit.com/#repository-local-hooks
  #   - Python subprocess: https://docs.python.org/3/library/subprocess.html
  - repo: local
    hooks:
      - id: check-attribute-errors
        name: Check for AttributeError patterns
        entry: python3 -c "import sys, re; content = open('linux-wallpaperengine-gtk.py', 'r').read(); matches = [(m.start(), m.group()) for m in re.finditer(r'self\.settings', content)]; wrong = [m for i, m in matches if 'WallpaperWindow' not in content[max(0,i-200):i+200] and 'SettingsDialog' not in content[max(0,i-200):i+200]]; sys.exit(1 if wrong else 0)"
        language: system
        files: ^linux-wallpaperengine-gtk\.py$
        pass_filenames: false

      - id: check-shell-injection
        name: Check for shell injection risks
        entry: python3 -c "import sys; content = open('linux-wallpaperengine-gtk.py', 'r').read(); sys.exit(1 if 'shell=True' in content else 0)"
        language: system
        files: ^linux-wallpaperengine-gtk\.py$
        pass_filenames: false

      - id: check-broad-exceptions
        name: Check for bare except clauses
        entry: python3 -c "import sys, re; content = open('linux-wallpaperengine-gtk.py', 'r').read(); bare_except = re.findall(r'^\s*except\s*:', content, re.MULTILINE); sys.exit(1 if bare_except else 0)"
        language: system
        files: ^linux-wallpaperengine-gtk\.py$
        pass_filenames: false

  # Prettier - Code formatter for various file types (always enabled)
  # References:
  #   - Prettier: https://prettier.io/
  #   - pre-commit prettier: https://pre-commit.com/hooks.html#prettier
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        types_or:
          [javascript, jsx, ts, tsx, json, css, scss, html, yaml, markdown, mdx]
        files: \.(js|jsx|ts|tsx|json|css|scss|html|yaml|yml|md|mdx|jsonc|code-workspace)$

  # Pre-commit hooks - Basic file hygiene (always enabled)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: check-json
        exclude: \.(jsonc|code-workspace)$ # JSONC handled by Prettier
      - id: check-toml
      - id: debug-statements
      - id: name-tests-test
      - id: requirements-txt-fixer
      - id: fix-byte-order-marker

  # ShellCheck - Shell script linter (always enabled)
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.11.0.1
    hooks:
      - id: shellcheck
        args: [--severity=warning]

  # YAML linting (always enabled)
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint
        args:
          - "--format"
          - "parsable"
          - "-d"
          - "{extends: default, rules: {line-length: {max: 100, level: warning}, truthy: {allowed-values: ['true', 'false'], check-keys: false}}}"

  # Git hooks for commit message format (always enabled)
  - repo: https://github.com/alessandrojcm/commitlint-pre-commit-hook
    rev: v9.23.0
    hooks:
      - id: commitlint
        stages: [commit-msg]
        additional_dependencies: ["@commitlint/config-conventional"]
  # jscpd - DRY Enforcement (Code Duplication Detection)
  # References:
  #   - jscpd: https://github.com/kucherenko/jscpd
  #   - DRY principle: https://en.wikipedia.org/wiki/Don%27t_repeat_yourself
  # Configuration: .jscpdrc.json
  # Justification for thresholds:
  #   - min-lines: 10 - Catches meaningful duplication, ignores trivial patterns
  #   - min-tokens: 50 - Requires substantial code blocks to flag
  #   - threshold: 1% - Very strict, but necessary for monolithic file structure
  #   - Excludes: Test files, minified code, build artifacts
  # Note: Using local hook due to npm dependency conflicts in upstream repo
  - repo: local
    hooks:
      - id: jscpd
        name: jscpd
        entry: jscpd --config .jscpdrc.json
        language: system
        files: \.(py|js|ts|json|yaml|yml)$
        exclude: ^(.*\.min\.js|.*\.bundle\.js|node_modules|__pycache__|\.git|.*test.*|.*spec.*)
